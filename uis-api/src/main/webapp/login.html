<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Login</title>
	
	<link rel="stylesheet" type="text/css" href="js/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="style/signin.css">
  
	<script type="text/javascript" src="js/jquery/jquery-1.11.1.min.js"></script>
	<script type='text/javascript' src='js/bootstrap/js/bootstrap.min.js'></script>
</head>
<body>
<div class="container">

  <div class="form-signin" role="form">
    <h2 class="form-signin-heading">Please sign in</h2>
    <input type="text" name="j_username" class="form-control" placeholder="Login" required="" autofocus="">
    <input type="password" name="j_password" class="form-control" placeholder="Password" required="">
    <button class="btn btn-lg btn-primary btn-block" onclick="login();">Sign in</button>
  </div>

  <div id="errmsg">
  	Login/password incorrect
  </div>

</div>
</body>

<script>
	jQuery('#errmsg').hide();
	
	function getQueryVariable(variable) {
		var query = window.location.search.substring(1);
		var vars = query.split("&");
		
		for (var i=0;i<vars.length;i++) {
			var pair = vars[i].split("=");
			
			if (pair[0] == variable) {
				return pair[1];
			}
		} 
	}
	
	var url = getQueryVariable('url');
	
	function login() {
		var login = jQuery('input[name=j_username]').val();
		var password = jQuery('input[name=j_password]').val();
		
		var dataString = 'j_username='+login
					   +'&j_password='+password;
		
		jQuery.ajax({
			type: "POST",
			url: "j_security_check",
			data: dataString,
			success: function(data) {
				jQuery('#errmsg').hide();
				console.log(data);
				
				if (data === 'success') {
					window.location = url;
				}
				
				if (data === 'error') {
					console.log('aha error');
					jQuery('#errmsg').show();
				}
			}
		});
	};

	jQuery.ajax({
		type: "GET",
		url: "http://localhost:8080/uis-api/rest/secure/service",
		//data: "url=http://localhost/es/ui/app",
		success: function(data) {
			console.log(data);
		}
	});
</script>
</html>